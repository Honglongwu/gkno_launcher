{
  "description" : "Build Mosaik reference files and align fastq files using Mosaik (additional processing steps included).",

  "tasks" : {
    "build-reference" : {
      "tool" : "mosaik-build-reference"
    },
    "build-jump-database" : {
      "tool" : "mosaik-jump"
    },
    "build-read-archive" : {
      "tool" : "mosaik-build-fastq"
    },
    "align" : {
      "tool" : "mosaik-aligner"
    },
    "sort-primary-bam" : {
      "tool" : "bamtools-sort"
    },
    "sort-multiple-bam" : {
      "tool" : "bamtools-sort"
    },
    "recalibrate-bq" : {
      "tool" : "recab"
    },
    "mark-duplicates" : {
      "tool" : "dedup"
    },
    "index-final-bam" : {
      "tool" : "bamtools-index"
    },
    "filter-bam" : {
      "tool" : "bamtools-filter",
      "output to stream" : true
    },
    "realign-gaps" : {
      "tool" : "ogap",
      "output to stream" : true
    },
    "left-align-indels" : {
      "tool" : "bamleftalign"
    },
    "variant-call" : {
      "tool" : "freebayes"
    }
  },

  "nodes" : [
    {
      "ID" : "fasta reference",
      "description" : "The input fasta reference.",
      "long form argument" : "--fasta-reference",
      "short form argument" : "-r",
      "tasks" : {
        "build-reference" : "--fasta-reference",
        "recalibrate-bq" : "--fasta-reference",
        "realign-gaps" : "--fasta-reference",
        "left-align-indels" : "--fasta-reference",
        "variant-call" : "--fasta-reference"
      }
    },
    {
      "ID" : "mosaik reference",
      "description" : "The binary reference for use with Mosaik.",
      "long form argument" : "--mosaik-reference",
      "short form argument" : "-m",
      "tasks" : {
        "build-reference" : "--mosaik-reference",
        "build-jump-database" : "--mosaik-reference",
        "align" : "--mosaik-reference"
      }
    },
    {
      "ID" : "hash size",
      "description" : "The hash size for the reference.",
      "long form argument" : "--hash-size",
      "short form argument" : "-hs",
      "tasks" : {
        "build-jump-database" : "--hash-size",
        "align" : "--hash-size"
      }
    },
    {
      "ID" : "jump",
      "description" : "Stub for Mosaik jump table files.",
      "long form argument" : "--jump-database",
      "short form argument" : "-j",
      "tasks" : {
        "build-jump-database" : "--jump-database",
        "align" : "--jump-database"
      }
    },
    {
      "ID" : "fastq",
      "description" : "The first mate fastq sequencing read file.",
      "long form argument" : "--fastq",
      "short form argument" : "-q",
      "tasks" : {
        "build-read-archive" : "--fastq"
      }
    },
    {
      "ID" : "fastq2",
      "description" : "The second mate fastq sequencing read file.",
      "long form argument" : "--fastq2",
      "short form argument" : "-q2",
      "tasks" : {
        "build-read-archive" : "--fastq2"
      }
    },
    {
      "ID" : "tech",
      "description" : "The read sequencing technology: '454', 'helicos', 'illumina', 'illumina_long', 'sanger' or 'solid'",
      "long form argument" : "--sequencing-technology",
      "short form argument" : "-s",
      "tasks" : {
        "build-read-archive" : "--sequencing-technology"
      }
    },
    {
      "ID" : "fragment length",
      "description" : "The median length for the read fragments.",
      "long form argument" : "--median-fragment-length",
      "short form argument" : "-mf",
      "tasks" : {
        "build-read-archive" : "--median-fragment-length"
      }
    },
    {
      "ID" : "read archive",
      "description" : "The output read archive.",
      "long form argument" : "--read-archive",
      "short form argument" : "-a",
      "tasks" : {
        "build-read-archive" : "--read-archive",
        "align" : "--read-archive"
      }
    },
    {
      "ID" : "annse",
      "description" : "The neural network parameters file for Mosaik mapping quality scores (single end).",
      "long form argument" : "--ann-single-end",
      "short form argument" : "-as",
      "tasks" : {
        "align" : "--ann-single-end"
      }
    },
    {
      "ID" : "annpe",
      "description" : "The neural network parameters file for Mosaik mapping quality scores (paired end).",
      "long form argument" : "--ann-paired-end",
      "short form argument" : "-ap",
      "tasks" : {
        "align" : "--ann-paired-end"
      }
    },
    {
      "ID" : "sort",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "align" : "--out",
        "sort-primary-bam" : "--in"
      },
      "extension" : "bam"
    },
    {
      "ID" : "sort multiple",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "align" : "--out",
        "sort-multiple-bam" : "--in"
      },
      "extension" : "multiple.bam"
    },
    {
      "ID" : "covariate input",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "sort-primary-bam" : "--out",
        "recalibrate-bq" : "--in"
      }
    },
    {
      "ID" : "dbsnp",
      "description" : "Linking tasks. No argument.",
      "description" : "A database of known polymorphic sites to skip over in the recalibration algorithm.",
      "long form argument" : "--dbsnp",
      "short form argument" : "-db",
      "tasks" : {
        "recalibrate-bq" : "--dbsnp"
      }
    },
    {
      "ID" : "mark duplicates",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "recalibrate-bq" : "--out",
        "mark-duplicates" : "--in"
      }
    },
    {
      "ID" : "index final",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "mark-duplicates" : "--out",
        "filter-bam" : "--in"
      }
    },
    {
      "ID" : "filter",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "mark-duplicates" : "--out",
        "filter-bam" : "--in"
      }
    },
    {
      "ID" : "realign gaps",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "filter-bam" : "--out",
        "realign-gaps" : "--in"
      }
    },
    { 
      "ID" : "left align",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "realign-gaps" : "--out",
        "left-align-indels" : "--in"
      }
    },
    {
      "ID" : "call",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "left-align-indels" : "--out",
        "index-final-bam" : "--in",
        "variant-call" : "--bam"
      }
    },
    {
      "ID" : "bam index",
      "description" : "Linking tasks. No argument.",
      "tasks" : {
        "index-final-bam" : "--out",
        "variant-call" : "--bam-index"
      }
    }
  ],

  "instances" : [
    {
      "ID" : "default",
      "description" : "The default instance sets all the parameters for the pipeline to run.",
      "nodes" : [
        {
          "ID" : "fasta reference",
          "argument" : "--fasta",
          "values" : ["$(RESOURCES)/tutorial/current/test_genome.fa"]
        },
        {
          "ID" : "hash size",
          "argument" : "--hash-size",
          "values" : ["10"]
        },
        {
          "ID" : "fastq",
          "argument" : "--fastq",
          "values" : ["$(RESOURCES)/tutorial/current/simulated_reads_1.fq"]
        },
        {
          "ID" : "fastq2",
          "argument" : "--fastq2",
          "values" : ["$(RESOURCES)/tutorial/current/simulated_reads_2.fq"]
        },
        {
          "ID" : "annse",
          "argument" : "--ann-se",
          "values" : ["$(RESOURCES)/tutorial/current/se.100.005.ann"]
        },
        {
          "ID" : "annpe",
          "argument" : "--ann-pe",
          "values" : ["$(RESOURCES)/tutorial/current/pe.100.01.ann"]
        },
        {
          "ID" : "tech",
          "argument" : "--sequencing-technology",
          "values" : ["illumina"]
        },
        {
          "ID" : "dbsnp",
          "argument" : "--dbsnp",
          "values" : ["$(RESOURCES)/tutorial/current/test_genome.dbSNP.snps.sites.vcf"]
        }
      ]
    }
  ]
}
