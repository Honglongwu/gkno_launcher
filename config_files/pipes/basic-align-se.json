{
  "description" : "Align fastq files using Mosaik (additional processing steps included).",
  "workflow" : [
    "generate-mosaik-parameters",
    "build-read-archive",
    "align",
    "sort-primary-bam",
    "index-primary-bam",
    "get-alignment-stats"
  ],

  "tools" : {
    "generate-mosaik-parameters" : "premo",
    "build-read-archive" : "mosaik-build-fastq",
    "align" : "mosaik-aligner",
    "sort-primary-bam" : "bamtools-sort",
    "index-primary-bam" : "bamtools-index",
    "get-alignment-stats" : "bamtools-stats"
  },

  "construct filenames" : {
    "get-alignment-stats" : {
      "-out" : {
        "filename root" : "from argument",
        "get root from task" : "get-alignment-stats",
        "get root from argument" : "-in",
        "remove input extension" : false
      }
    }
  },

  "linkage" : {
    "build-read-archive" : {
      "-q" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-fq1"
      },
      "-st" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-st"
      },
      "json parameters" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-out",
        "json block" : "MosaikBuild"
      }
    },
    "align" : {
      "-in" : {
        "link to this task" : "build-read-archive",
        "link to this argument" : "-out"
      },
      "-ia" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-ref"
      },
      "-hs" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-hs"
      },
      "-j" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-jmp"
      },
      "-annse" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-annse"
      },
      "-annpe" : {
        "link to this task" : "generate-mosaik-parameters",
        "link to this argument" : "-annpe"
      }
    },
    "sort-primary-bam" : {
      "-in" : {
        "link to this task" : "align",
        "link to this argument" : "-out",
        "extension" : ".bam"
      }
    },
    "index-primary-bam" : {
      "-in" : {
        "link to this task" : "sort-primary-bam",
        "link to this argument" : "-out"
      }
    },
    "get-alignment-stats" : {
      "-in" : {
        "link to this task" : "sort-primary-bam",
        "link to this argument" : "-out"
      }
    }
  },

  "arguments" : {
    "--fastq" : {
      "description" : "The input fastq file (first mate).",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-fq1",
      "short form argument" : "-q",
      "type" : "string",
      "required" : "true"
    },
    "--mosaik-reference" : {
      "description" : "The Mosaik format reference genome (.dat).",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-ref",
      "short form argument" : "-r",
      "type" : "string"
    },
    "--mosaik-jump-database" : {
      "description" : "The input Mosaik jump database stub.",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-jmp",
      "short form argument" : "-j",
      "type" : "string"
    },
    "--batch-size" : {
      "description" : "Number of pairs to align per batch.",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-n",
      "short form argument" : "-b",
      "type" : "integer"
    },
    "--hash-size" : {
      "description" : "The hash-size used in Mosaik [4 - 32].",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-hs",
      "type" : "integer",
      "short form argument" : "-hs"
    },
    "--sequencing-technology" : {
      "description" : "Sequencing technology: '454', 'helicos', 'illumina', 'illumina_long', 'sanger' or 'solid'.",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-st",
      "short form argument" : "-st",
      "type" : "string"
    },
    "--ann-se" : {
      "description" : "Neural network file for Mosaik mapping quality scores (single end).",
      "short form argument" : "-as",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-annse",
      "type" : "string"
    },
    "--single-end" : {
      "description" : "Set premo to work in single-end mode [true].",
      "short form argument" : "-se",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-se",
      "type" : "flag"
    },
    "--ann-pe" : {
      "description" : "Neural network file for Mosaik mapping quality scores (paired end).",
      "short form argument" : "-ap",
      "link to this task" : "generate-mosaik-parameters",
      "link to this argument" : "-annpe",
      "type" : "string"
    },
    "--median-fragment-length" : {
      "description" : "median fragment length.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-mfl",
      "type" : "integer",
      "short form argument" : "-mfl"
    },
    "--out" : {
      "description" : "The output read archive.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-out",
      "short form argument" : "-o",
      "type" : "string"
    },
    "--sample" : {
      "description" : "The sample name. e.g. NA12878.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-sam",
      "short form argument" : "-sm",
      "type" : "string"
    },
    "--center" : {
      "description" : "The sequencing center name.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-cn",
      "short form argument" : "-cn",
      "type" : "string"
    },
    "--read-group" : {
      "description" : "The read group ID. e.g. SRR009060.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-id",
      "short form argument" : "-rg",
      "type" : "string"
    },
    "--library" : {
      "description" : "The library name. e.g. g1k-sc-NA18944-JPT-1.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-ln",
      "short form argument" : "-lb",
      "type" : "string"
    },
    "--platform-name" : {
      "description" : "The platform unit. e.g. IL12_490_5.",
      "link to this task" : "build-read-archive",
      "link to this argument" : "-pu",
      "short form argument" : "-pn",
      "type" : "string"
    },
    "--special-references" : {
      "description" : "Specifies the prefixes of 'special' reference sequences.",
      "link to this task" : "align",
      "link to this argument" : "-sref",
      "short form argument" : "-sr",
      "type" : "string"
    },
    "--special-reference-hashes" : {
      "description" : "Specifies the maximum number of hashes for the special reference sequences.",
      "link to this task" : "align",
      "link to this argument" : "-srefn",
      "short form argument" : "-srh",
      "type" : "integer"
    },
    "--alignment-candidate-threshold" : {
      "description" : "Specifies the minimum length of an alignment candidate.",
      "link to this task" : "align",
      "link to this argument" : "-act",
      "short form argument" : "-act",
      "type" : "integer"
    },
    "--maximum-hash-position" : {
      "description" : "Specifies the maximum number of positions stored for each hash.",
      "link to this task" : "align",
      "link to this argument" : "-mhp",
      "short form argument" : "-mhp",
      "type" : "integer"
    }
  },

  "delete files" : {
    "build-read-archive" : {
      "-out" : {
        "delete after task" : "align"
      }
    },
    "align" : {
      "-out" : {
        "output extension" : [
          ".bam"
        ],
        "delete after task" : [
          "sort-primary-bam"
        ]
      }
    }
  },

  "instances" : {
    "default" : {
      "description" : "Default instance requires user to input all input filenames."
    },
    "test" : {
      "description" : "Test instance for the test harness.",
      "--reference-fasta" : "$(RESOURCES)/tutorial/current/test_genome.fa",
      "--mosaik-jump-database" : "$(RESOURCES)/tutorial/current/test_genome_10",
      "--mosaik-reference" : "$(RESOURCES)/tutorial/current/test_genome.dat",
      "--fastq" : "$(RESOURCES)/tutorial/current/simulated_reads_1.fq",
      "--fastq2" : "$(RESOURCES)/tutorial/current/simulated_reads_2.fq",
      "--ann-se" : "$(RESOURCES)/tutorial/current/se.100.005.ann",
      "--ann-pe" : "$(RESOURCES)/tutorial/current/pe.100.01.ann",
      "--single-end" : "set",
      "--hash-size" : "10"
    },
    "human" : {
      "description" : "Human instance uses the human reference from the resources.  It is assumed that the Mosaik reference files have been created in the current working directory.",
      "--reference-fasta" : "$(PWD)/human_reference_v37_decoys_moblist.fa",
      "--mosaik-jump-database" : "$(PWD)/human_reference_v37_decoys_moblist_15",
      "--mosaik-reference" : "$(PWD)/human_reference_v37_decoys_moblist.dat",
      "--ann-se" : "$(RESOURCES)/homo_sapiens/current/se.100.005.ann",
      "--ann-pe" : "$(RESOURCES)/homo_sapiens/current/pe.100.01.ann"
    },
    "human-moblist" : {
      "description" : "Human-moblist instance uses the human reference with moblistfrom the resources.  It is assumed that the Mosaik reference files have been created in the current working directory.",
      "--reference-fasta" : "$(PWD)/human_reference_v37_decoys_moblist.fa",
      "--mosaik-jump-database" : "$(PWD)/human_reference_v37_decoys_moblist_15",
      "--mosaik-reference" : "$(PWD)/human_reference_v37_decoys_moblist.dat",
      "--ann-se" : "$(RESOURCES)/homo_sapiens/current/se.100.005.ann",
      "--ann-pe" : "$(RESOURCES)/homo_sapiens/current/pe.100.01.ann",
      "--single-end" : "set"
    },
    "tutorial" : {
      "description" : "Tutorial instance uses files from the tutorial resources.",
      "--reference-fasta" : "$(RESOURCES)/tutorial/current/test_genome.fa",
      "--mosaik-jump-database" : "$(PWD)/test_genome_10",
      "--mosaik-reference" : "$(PWD)/test_genome.dat",
      "--fastq" : "$(RESOURCES)/tutorial/current/simulated_reads_1.fq",
      "--fastq2" : "$(RESOURCES)/tutorial/current/simulated_reads_2.fq",
      "--ann-se" : "$(RESOURCES)/tutorial/current/se.100.005.ann",
      "--ann-pe" : "$(RESOURCES)/tutorial/current/pe.100.01.ann",
      "--single-end" : "set",
      "--hash-size" : "10"
    },
    "1000G-tutorial" : {
      "description" : "1000G tutorial instance is for use with the 1000G tutorial only.",
      "--reference-fasta" : "$(RESOURCES)/tutorial/current/test_genome.fa",
      "--mosaik-jump-database" : "$(PWD)/test_genome_10",
      "--mosaik-reference" : "$(PWD)/test_genome.dat",
      "--ann-se" : "$(RESOURCES)/tutorial/current/se.100.005.ann",
      "--ann-pe" : "$(RESOURCES)/tutorial/current/pe.100.01.ann",
      "--single-end" : "set",
      "--hash-size" : "10"
    }
  }
}
